{"version":3,"file":"file-url-1a9970c0.js","sources":["../../../../js/wasm/network/host.ts","../../../../js/wasm/svelte/file-url.ts"],"sourcesContent":["export function is_self_host(url: URL): boolean {\n\treturn (\n\t\turl.host === window.location.host ||\n\t\turl.host === \"localhost:7860\" ||\n\t\turl.host === \"127.0.0.1:7860\" || // Ref: https://github.com/gradio-app/gradio/blob/v3.32.0/js/app/src/Index.svelte#L194\n\t\turl.host === \"lite.local\" // A special hostname set when the endpoint is a local file (`file:/*`). See `determine_protocol()` in `client/js/src/utils.ts`\n\t);\n}\n","import { getWorkerProxyContext } from \"./context\";\nimport { is_self_host } from \"../network/host\";\n\ntype MediaSrc = string | undefined | null;\n\nexport async function resolve_wasm_src(src: MediaSrc): Promise<MediaSrc> {\n\tif (src == null) {\n\t\treturn src;\n\t}\n\n\tconst url = new URL(src);\n\tif (!is_self_host(url)) {\n\t\t// `src` is not accessing a local server resource, so we don't need to proxy this request to the Wasm worker.\n\t\treturn src;\n\t}\n\tif (url.protocol !== \"http:\" && url.protocol !== \"https:\") {\n\t\t// `src` can be a data URL.\n\t\treturn src;\n\t}\n\n\tconst maybeWorkerProxy = getWorkerProxyContext();\n\tif (maybeWorkerProxy == null) {\n\t\t// We are not in the Wasm env. Just use the src as is.\n\t\treturn src;\n\t}\n\n\tconst path = url.pathname;\n\treturn maybeWorkerProxy\n\t\t.httpRequest({\n\t\t\tmethod: \"GET\",\n\t\t\tpath,\n\t\t\theaders: {},\n\t\t\tquery_string: \"\"\n\t\t})\n\t\t.then((response) => {\n\t\t\tif (response.status !== 200) {\n\t\t\t\tthrow new Error(`Failed to get file ${path} from the Wasm worker.`);\n\t\t\t}\n\t\t\tconst blob = new Blob([response.body], {\n\t\t\t\ttype: response.headers[\"Content-Type\"]\n\t\t\t});\n\t\t\tconst blobUrl = URL.createObjectURL(blob);\n\t\t\treturn blobUrl;\n\t\t});\n}\n"],"names":[],"mappings":";;AAAO,SAAS,aAAa,GAAmB,EAAA;AAC/C,EACC,OAAA,GAAA,CAAI,SAAS,MAAO,CAAA,QAAA,CAAS,QAC7B,GAAI,CAAA,IAAA,KAAS,gBACb,IAAA,GAAA,CAAI,IAAS,KAAA,gBAAA;AAAA,EACb,IAAI,IAAS,KAAA,YAAA,CAAA;AAEf;;ACFA,eAAsB,iBAAiB,GAAkC,EAAA;AACxE,EAAA,IAAI,OAAO,IAAM,EAAA;AAChB,IAAO,OAAA,GAAA,CAAA;AAAA,GACR;AAEA,EAAM,MAAA,GAAA,GAAM,IAAI,GAAA,CAAI,GAAG,CAAA,CAAA;AACvB,EAAI,IAAA,CAAC,YAAa,CAAA,GAAG,CAAG,EAAA;AAEvB,IAAO,OAAA,GAAA,CAAA;AAAA,GACR;AACA,EAAA,IAAI,GAAI,CAAA,QAAA,KAAa,OAAW,IAAA,GAAA,CAAI,aAAa,QAAU,EAAA;AAE1D,IAAO,OAAA,GAAA,CAAA;AAAA,GACR;AAEA,EAAA,MAAM,mBAAmB,qBAAsB,EAAA,CAAA;AAC/C,EAAA,IAAI,oBAAoB,IAAM,EAAA;AAE7B,IAAO,OAAA,GAAA,CAAA;AAAA,GACR;AAEA,EAAA,MAAM,OAAO,GAAI,CAAA,QAAA,CAAA;AACjB,EAAA,OAAO,iBACL,WAAY,CAAA;AAAA,IACZ,MAAQ,EAAA,KAAA;AAAA,IACR,IAAA;AAAA,IACA,SAAS,EAAC;AAAA,IACV,YAAc,EAAA,EAAA;AAAA,GACd,CAAA,CACA,IAAK,CAAA,CAAC,QAAa,KAAA;AACnB,IAAI,IAAA,QAAA,CAAS,WAAW,GAAK,EAAA;AAC5B,MAAM,MAAA,IAAI,KAAM,CAAA,CAAA,mBAAA,EAAsB,IAA4B,CAAA,sBAAA,CAAA,CAAA,CAAA;AAAA,KACnE;AACA,IAAA,MAAM,OAAO,IAAI,IAAA,CAAK,CAAC,QAAA,CAAS,IAAI,CAAG,EAAA;AAAA,MACtC,IAAA,EAAM,QAAS,CAAA,OAAA,CAAQ,cAAc,CAAA;AAAA,KACrC,CAAA,CAAA;AACD,IAAM,MAAA,OAAA,GAAU,GAAI,CAAA,eAAA,CAAgB,IAAI,CAAA,CAAA;AACxC,IAAO,OAAA,OAAA,CAAA;AAAA,GACP,CAAA,CAAA;AACH;;;;"}